{"ast":null,"code":"import { DataModule } from \"./DataModule.js\";\nimport { StateManager } from './StateManager.js';\nimport { ImageModule } from './ImageModule.js';\n\n/**\r\n * @module StreetViewModule\r\n * @description Manages street view image retrieval and display for path segments,\r\n * including fallback handling for missing images and error states.\r\n */\nexport const StreetViewModule = {\n  /** @constant {string} DEFAULT_IMAGE - Path to the default fallback image */\n  DEFAULT_IMAGE: '/assets/no-streetview.jpg',\n  imageCache: new Map(),\n  loadingImages: new Set(),\n  worker: new Worker(new URL('../workers/ImageWorker.js', import.meta.url)),\n  constructor() {\n    this.worker.onmessage = ({\n      data: {\n        key,\n        bitmap,\n        error\n      }\n    }) => {\n      if (bitmap) {\n        this.imageCache.set(key, bitmap);\n      }\n      this.loadingImages.delete(key);\n    };\n  },\n  /**\r\n   * Preloads images for the given path.\r\n   * @param {Array} path - The path segments to preload images for\r\n   */\n  async preloadImagesForPath(path) {\n    if (!(path !== null && path !== void 0 && path.length)) return;\n    const promises = [];\n    for (let i = 0; i < path.length - 1; i++) {\n      const imageKey = `${path[i]}-${path[i + 1]}.jpg`;\n      if (!this.imageCache.has(imageKey) && !this.loadingImages.has(imageKey)) {\n        this.loadingImages.add(imageKey);\n        const imageUrl = ImageModule.getImageUrl(imageKey);\n        if (imageUrl) {\n          this.worker.postMessage({\n            imageUrl,\n            key: imageKey\n          });\n        }\n      }\n    }\n  },\n  /**\r\n   * Retrieves the appropriate street view image for the current path segment.\r\n   * @returns {string} URL of the street view image or default image if none available\r\n   * @throws {Error} When image retrieval fails\r\n   */\n  getImage() {\n    const currentPathSegment = StateManager.get('currentPathSegment');\n    const path = StateManager.get('path');\n    if (!path || currentPathSegment === undefined) {\n      return this.DEFAULT_IMAGE;\n    }\n    const imageKey = `${path[currentPathSegment]}-${path[currentPathSegment + 1]}.jpg`;\n    return this.imageCache.has(imageKey) ? this.imageCache.get(imageKey) : this.DEFAULT_IMAGE;\n  },\n  /**\r\n   * Clears the image cache.\r\n   */\n  clearCache() {\n    this.imageCache.clear();\n  }\n};","map":{"version":3,"names":["DataModule","StateManager","ImageModule","StreetViewModule","DEFAULT_IMAGE","imageCache","Map","loadingImages","Set","worker","Worker","URL","import","meta","url","constructor","onmessage","data","key","bitmap","error","set","delete","preloadImagesForPath","path","length","promises","i","imageKey","has","add","imageUrl","getImageUrl","postMessage","getImage","currentPathSegment","get","undefined","clearCache","clear"],"sources":["C:/Users/rexrt/Downloads/hsenavrepo/HseMaps/src/modules/StreetViewModule.js"],"sourcesContent":["import { DataModule } from \"./DataModule.js\";\r\nimport { StateManager } from './StateManager.js';\r\nimport { ImageModule } from './ImageModule.js';\r\n\r\n/**\r\n * @module StreetViewModule\r\n * @description Manages street view image retrieval and display for path segments,\r\n * including fallback handling for missing images and error states.\r\n */\r\nexport const StreetViewModule = {\r\n    /** @constant {string} DEFAULT_IMAGE - Path to the default fallback image */\r\n    DEFAULT_IMAGE: '/assets/no-streetview.jpg',\r\n    imageCache: new Map(),\r\n    loadingImages: new Set(),\r\n    worker: new Worker(new URL('../workers/ImageWorker.js', import.meta.url)),\r\n\r\n    constructor() {\r\n        this.worker.onmessage = ({ data: { key, bitmap, error } }) => {\r\n            if (bitmap) {\r\n                this.imageCache.set(key, bitmap);\r\n            }\r\n            this.loadingImages.delete(key);\r\n        };\r\n    },\r\n\r\n    /**\r\n     * Preloads images for the given path.\r\n     * @param {Array} path - The path segments to preload images for\r\n     */\r\n    async preloadImagesForPath(path) {\r\n        if (!path?.length) return;\r\n        \r\n        const promises = [];\r\n        for (let i = 0; i < path.length - 1; i++) {\r\n            const imageKey = `${path[i]}-${path[i + 1]}.jpg`;\r\n            if (!this.imageCache.has(imageKey) && !this.loadingImages.has(imageKey)) {\r\n                this.loadingImages.add(imageKey);\r\n                const imageUrl = ImageModule.getImageUrl(imageKey);\r\n                if (imageUrl) {\r\n                    this.worker.postMessage({ imageUrl, key: imageKey });\r\n                }\r\n            }\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Retrieves the appropriate street view image for the current path segment.\r\n     * @returns {string} URL of the street view image or default image if none available\r\n     * @throws {Error} When image retrieval fails\r\n     */\r\n    getImage() {\r\n        const currentPathSegment = StateManager.get('currentPathSegment');\r\n        const path = StateManager.get('path');\r\n\r\n        if (!path || currentPathSegment === undefined) {\r\n            return this.DEFAULT_IMAGE;\r\n        }\r\n\r\n        const imageKey = `${path[currentPathSegment]}-${path[currentPathSegment + 1]}.jpg`;\r\n        return this.imageCache.has(imageKey) ? \r\n            this.imageCache.get(imageKey) : \r\n            this.DEFAULT_IMAGE;\r\n    },\r\n\r\n    /**\r\n     * Clears the image cache.\r\n     */\r\n    clearCache() {\r\n        this.imageCache.clear();\r\n    }\r\n};"],"mappings":"AAAA,SAASA,UAAU,QAAQ,iBAAiB;AAC5C,SAASC,YAAY,QAAQ,mBAAmB;AAChD,SAASC,WAAW,QAAQ,kBAAkB;;AAE9C;AACA;AACA;AACA;AACA;AACA,OAAO,MAAMC,gBAAgB,GAAG;EAC5B;EACAC,aAAa,EAAE,2BAA2B;EAC1CC,UAAU,EAAE,IAAIC,GAAG,CAAC,CAAC;EACrBC,aAAa,EAAE,IAAIC,GAAG,CAAC,CAAC;EACxBC,MAAM,EAAE,IAAIC,MAAM,CAAC,IAAIC,GAAG,CAAC,2BAA2B,EAAEC,MAAM,CAACC,IAAI,CAACC,GAAG,CAAC,CAAC;EAEzEC,WAAWA,CAAA,EAAG;IACV,IAAI,CAACN,MAAM,CAACO,SAAS,GAAG,CAAC;MAAEC,IAAI,EAAE;QAAEC,GAAG;QAAEC,MAAM;QAAEC;MAAM;IAAE,CAAC,KAAK;MAC1D,IAAID,MAAM,EAAE;QACR,IAAI,CAACd,UAAU,CAACgB,GAAG,CAACH,GAAG,EAAEC,MAAM,CAAC;MACpC;MACA,IAAI,CAACZ,aAAa,CAACe,MAAM,CAACJ,GAAG,CAAC;IAClC,CAAC;EACL,CAAC;EAED;AACJ;AACA;AACA;EACI,MAAMK,oBAAoBA,CAACC,IAAI,EAAE;IAC7B,IAAI,EAACA,IAAI,aAAJA,IAAI,eAAJA,IAAI,CAAEC,MAAM,GAAE;IAEnB,MAAMC,QAAQ,GAAG,EAAE;IACnB,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGH,IAAI,CAACC,MAAM,GAAG,CAAC,EAAEE,CAAC,EAAE,EAAE;MACtC,MAAMC,QAAQ,GAAG,GAAGJ,IAAI,CAACG,CAAC,CAAC,IAAIH,IAAI,CAACG,CAAC,GAAG,CAAC,CAAC,MAAM;MAChD,IAAI,CAAC,IAAI,CAACtB,UAAU,CAACwB,GAAG,CAACD,QAAQ,CAAC,IAAI,CAAC,IAAI,CAACrB,aAAa,CAACsB,GAAG,CAACD,QAAQ,CAAC,EAAE;QACrE,IAAI,CAACrB,aAAa,CAACuB,GAAG,CAACF,QAAQ,CAAC;QAChC,MAAMG,QAAQ,GAAG7B,WAAW,CAAC8B,WAAW,CAACJ,QAAQ,CAAC;QAClD,IAAIG,QAAQ,EAAE;UACV,IAAI,CAACtB,MAAM,CAACwB,WAAW,CAAC;YAAEF,QAAQ;YAAEb,GAAG,EAAEU;UAAS,CAAC,CAAC;QACxD;MACJ;IACJ;EACJ,CAAC;EAED;AACJ;AACA;AACA;AACA;EACIM,QAAQA,CAAA,EAAG;IACP,MAAMC,kBAAkB,GAAGlC,YAAY,CAACmC,GAAG,CAAC,oBAAoB,CAAC;IACjE,MAAMZ,IAAI,GAAGvB,YAAY,CAACmC,GAAG,CAAC,MAAM,CAAC;IAErC,IAAI,CAACZ,IAAI,IAAIW,kBAAkB,KAAKE,SAAS,EAAE;MAC3C,OAAO,IAAI,CAACjC,aAAa;IAC7B;IAEA,MAAMwB,QAAQ,GAAG,GAAGJ,IAAI,CAACW,kBAAkB,CAAC,IAAIX,IAAI,CAACW,kBAAkB,GAAG,CAAC,CAAC,MAAM;IAClF,OAAO,IAAI,CAAC9B,UAAU,CAACwB,GAAG,CAACD,QAAQ,CAAC,GAChC,IAAI,CAACvB,UAAU,CAAC+B,GAAG,CAACR,QAAQ,CAAC,GAC7B,IAAI,CAACxB,aAAa;EAC1B,CAAC;EAED;AACJ;AACA;EACIkC,UAAUA,CAAA,EAAG;IACT,IAAI,CAACjC,UAAU,CAACkC,KAAK,CAAC,CAAC;EAC3B;AACJ,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}